<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>David K. Zhang - Legion Programming</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/litera/bootstrap.min.css" integrity="sha384-jWh2BIV7iyVvMfp6tT2MlPY25mY5ow68HOIK/tjzAwX3LtHpnRcXovTJ3vNx4imh" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
        <style>@import url('https://fonts.googleapis.com/css2?family=STIX+Two+Text:ital,wght@0,400;0,700;1,400;1,700&display=swap');

a:not([class]) { text-decoration: none; }
a:not([class]):hover { text-decoration: underline; }

.katex { font-size: 1.05em; }

h1.page-title {
    text-align: center;
    font-size: 2.0rem;
    padding: 1.0rem;
}

p {
    font-family: 'STIX Two Text', serif;
    text-align: justify;
}

.sans p {
    font-family: var(--bs-font-sans-serif);
    text-align: justify;
}

li {
    font-family: 'STIX Two Text', serif;
}

.navbar { padding: 0 0.5rem; }

.navbar li { font-family: var(--bs-font-sans-serif); }

.container-lg { max-width: 960px; }

.card-header { padding: 0.30rem 0.70rem 0.10rem; }
.card-body   { padding: 0.35rem 0.70rem; }

.card-header p:last-child { margin-bottom: 0; }
.card-body   p:last-child { margin-bottom: 0; }
.card-body  ul:last-child { margin-bottom: 0; }
.card-body  ol:last-child { margin-bottom: 0; }

.card-body p+ul { margin-top: -0.5rem; }
.card-body p+ol { margin-top: -0.5rem; }
.card-body ul+p { margin-top: -0.5rem; }
.card-body ol+p { margin-top: -0.5rem; }

.card-body .katex-display { margin: -0.5rem 0 0.5rem; }
.card hr { margin: 0.15rem 0; }

pre {
    color: black;
    background-color: var(--bs-gray-100);
    font-size: 1.0rem;
}

code {
    color: black;
    background-color: var(--bs-gray-100);
    font-size: 1.0rem;
}

.func-name { color: var(--bs-indigo); }
.arg { color: var(--bs-purple); }
</style>
    </head>
    <body>
        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light d-print-none">
    <a class="navbar-brand" href="/">
        <img src="/resources/favicon_crop.png" class="align-top" alt="David K. Zhang Logo" style="height: 2.0rem;">
        David K. Zhang
    </a>
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/index.html">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/projects.html">Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/publications.html">Publications</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="notesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Notes
                </a>
                <ul class="dropdown-menu" aria-labelledby="notesDropdown">
                    <li><h1 class="dropdown-header">Mathematics</h1></li>
                    <li><a class="dropdown-item" href="/groups.html">Group Theory</a></li>
                    <li><a class="dropdown-item" href="/rings.html">Ring Theory</a></li>
                    <li><a class="dropdown-item" href="/linalg.html">Linear Algebra</a></li>
                    <li><a class="dropdown-item" href="/topology.html">Topology</a></li>
                    <li><a class="dropdown-item" href="/misc.html">Miscellaneous Thoughts</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h1 class="dropdown-header">Computer Science</h1></li>
                    <li><a class="dropdown-item" href="/legion.html">Programming in Legion</a></li>
                </ul>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="dataDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Data
                </a>
                <ul class="dropdown-menu" aria-labelledby="dataDropdown">
                    <li><a class="dropdown-item" href="/misc.html">Miscellaneous Thoughts</a></li>
                </ul>
            </li>
        </ul>
        <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <a class="nav-link" href="/about.html">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/contact.html">Contact</a>
            </li>
        </ul>
    </div>
</nav>

        <div class="container-lg">
            <div class="d-print-none" style="padding-top: 4.0rem;"></div>
            <main><h1 class="page-title">Notes on Programming in Legion</h1>
<div class="text-center">
    David K. Zhang<br>
    Last Modified 2022-02-08
</div><br>
<hr>
<p>Construct a region <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mi>I</mi><mo>×</mo><mi>F</mi></mrow><annotation encoding="application/x-tex">R = I \times F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></eq> from an index space <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></eq> and a field space <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></eq>:</p>
<pre class="bg-light"><code>
    LogicalRegion rt-><b class="func-name">create_logical_region</b>(*, <b class="arg">IndexSpace I</b>, <b class="arg">FieldSpace F</b>);

</code></pre>
<p>This function takes an optional argument <code>bool task_local = false</code>. (<strong>TODO:</strong> What does this argument do?)</p>
<hr>
<pre><code>* Create a new top-level index space based on the given domain bounds
* If the bounds contains a Realm index space then Legion will take ownership of any sparsity maps.
* @param bounds the bounds for the new index space
* @param type_tag optional type tag to use for the index space
IndexSpace create_index_space(*, const Domain &amp;bounds, TypeTag type_tag = 0);
IndexSpaceT&lt;DIM, COORD_T&gt; create_index_space(*, const Rect&lt;DIM, COORD_T&gt; &amp;bounds);
IndexSpaceT&lt;DIM, COORD_T&gt; create_index_space(*, const DomainT&lt;DIM, COORD_T&gt; &amp;bounds);

* Create a new top-level index space from a future which contains a Domain object.
* If the Domain conaints a Realm index space then Legion will take ownership of any sparsity maps.
* @param dimensions number of dimensions for the created space
* @param future the future value containing the bounds
* @param type_tag optional type tag to use for the index space; defaults to 'coord_t'
IndexSpace create_index_space(*, size_t dimensions, const Future &amp;f, TypeTag type_tag = 0);
IndexSpaceT&lt;DIM,COORD_T&gt; create_index_space(*, const Future &amp;f);
</code></pre>
<pre><code>* Create a new top-level index space from a vector of points
* @param points a vector of points to have in the index space
IndexSpace create_index_space(*, const std::vector&lt;DomainPoint&gt; &amp;points);
IndexSpaceT&lt;DIM, COORD_T&gt; create_index_space(*, const std::vector&lt;Point&lt;DIM, COORD_T&gt;&gt; &amp;points);
</code></pre>
<pre><code>* Create a new top-level index space from a vector of rectangles
* @param rects a vector of rectangles to have in the index space
IndexSpace create_index_space(*, const std::vector&lt;Domain&gt; &amp;rects);
IndexSpaceT&lt;DIM, COORD_T&gt; create_index_space(*, const std::vector&lt;Rect&lt;DIM, COORD_T&gt;&gt; &amp;rects);
</code></pre>
<hr>
<h3>Resource Management</h3>
<p>In C, every call to <code>malloc</code> should be matched with a corresponding call to <code>free</code>. Similarly, in Legion, every runtime call of the form <code>create_*</code> should be matched with a corresponding <code>destroy_*</code> call.</p>
<pre class="bg-light"><code>
    <b class="return-type">void</b> rt-><b class="func-name">destroy_index_space</b>(*, <b class="arg">IndexSpace I</b>);
    <b class="return-type">void</b> rt-><b class="func-name">destroy_index_partition</b>(*, <b class="arg">IndexPartition P</b>);
    <b class="return-type">void</b> rt-><b class="func-name">destroy_field_space</b>(*, <b class="arg">FieldSpace F</b>);
    <b class="return-type">void</b> rt-><b class="func-name">destroy_logical_region</b>(*, <b class="arg">LogicalRegion R</b>);

</code></pre>
<p>All of the above <code>destroy_*</code> methods in Legion take an optional <code>bool unordered = false</code> parameter. Setting <code>unordered = true</code> informs Legion that this call to <code>destroy_*</code> may occur simultaneously with use of the resource being destroyed. This is necessary when the call to <code>destroy_*</code> is performed by a thread other than the one using the resource being destroyed, e.g., a garbage collector. In addition, <code>destroy_index_space</code> and <code>destroy_index_partition</code> take another optional parameter <code>bool recurse = true</code> that controls whether subspaces of the given index space <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></eq> (i.e., children of <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></eq> in the index tree) should also be destroyed.</p>
<h3>Reference Counting</h3>
<pre class="bg-light"><code>
    <b class="return-type">void</b> rt-><b class="func-name">create_shared_ownership</b>(*, <b class="arg">IndexSpace I</b>);
    <b class="return-type">void</b> rt-><b class="func-name">create_shared_ownership</b>(*, <b class="arg">IndexPartition P</b>);
    <b class="return-type">void</b> rt-><b class="func-name">create_shared_ownership</b>(*, <b class="arg">FieldSpace F</b>);
    <b class="return-type">void</b> rt-><b class="func-name">create_shared_ownership</b>(*, <b class="arg">LogicalRegion R</b>);

</code></pre>
<hr>
<pre class="bg-light"><code>
    <b class="return-type">bool</b> rt-><b class="func-name">is_index_partition_disjoint</b>(IndexPartition P);
    <b class="return-type">bool</b> rt-><b class="func-name">is_index_partition_complete</b>(IndexPartition P);
    <b class="return-type">bool</b> rt-><b class="func-name">has_parent_index_partition</b>(IndexSpace I);
    <b class="return-type">size_t</b> rt-><b class="func-name">get_field_size</b>(FieldSpace F, FieldID fid);
    <b class="return-type">void</b> rt-><b class="func-name">get_field_space_fields</b>(FieldSpace F, std::vector&lt;FieldID&gt; &fids);
    <b class="return-type">void</b> rt-><b class="func-name">get_field_space_fields</b>(FieldSpace F, std::set&lt;FieldID&gt; &fids);
    <b class="return-type">bool</b> rt-><b class="func-name">has_parent_logical_partition</b>(LogicalRegion handle);
    <b class="return-type">LogicalRegion</b> rt-><b class="func-name">get_parent_logical_region</b>(LogicalPartition handle);
    <b class="return-type">LogicalPartition</b> rt-><b class="func-name">get_parent_logical_partition</b>(LogicalRegion handle);

</code></pre>
<p>These functions do exactly what you think they do.</p>
<hr>
<p><code>LogicalPartition get_logical_partition(LogicalRegion R, IndexPartition P);</code></p>
</main>
            <div class="d-print-none">
                <hr>
                <footer>
                    <span class="float-end text-secondary mb-3">&copy; David K. Zhang 2016&ndash;2022</span>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://livejs.com/live.js"></script>
    </body>
</html>
